<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bulb Luminance</title>
    <script src="js/jquery.js" type="text/javascript"></script>
    <script src="js/csmapi.js"></script>

</head>
<body>
    <h1>Bulb Luminance</h1>
    <p id="luminance">Loading data...</p>
    <img id="rotate-img" src="./image.png" style="transform:rotate(0deg);">




    <script>

      var img = document.getElementById('rotate-img');
      var luminance = 0;

      function updateLuminance() {
          // 設定要 pull 的裝置和資訊
          var mac_addr = 'bulb111';
          var odf_name = 'Luminance';

          // 呼叫 csmapi.js 的 pull 函式
          csmapi.pull(mac_addr, odf_name, function(data, error) {
              if (error) {
                  console.error('Failed to pull Luminance:', error);
                  return;
              }

              // 取出最新一筆資料的值
              // console.log(data);
              var luminance = data[0][1][0];

              var rotation = luminance * 3.6;
              img.style.transform = `rotate(${rotation}deg)`;

              // 更新顯示在頁面上的資訊
              var luminanceElement = document.getElementById('luminance');
              luminanceElement.textContent = 'degree: ' + luminance;

              // 每 1 秒更新一次
              setTimeout(updateLuminance, 500);
            });
          
      }



      // 初始化
      csmapi.set_endpoint('https://6.iottalk.tw');
      updateLuminance();

    </script>
</body>
</html>
