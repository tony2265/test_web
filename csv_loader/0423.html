<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>è©©è‚¯å‘¨å‘¨æŠ½</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light py-5">

  <div class="container">
    <div class="card shadow p-4">
      <h2 class="mb-4">ğŸ“‹ è©©è‚¯å‘¨å‘¨æŠ½</h2>

      <p>ç›®å‰ç¸½äººæ•¸ï¼š<span class="fw-bold" id="total">è¼‰å…¥ä¸­...</span></p>

      <div class="mb-3">
        <label for="phone" class="form-label">è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼</label>
        <input type="text" id="phone" class="form-control" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿå¾ŒæŒ‰æŸ¥è©¢">
      </div>

      <button class="btn btn-primary" onclick="search()">æŸ¥è©¢æŠ½çè³‡æ ¼</button>

      <div id="query-result" class="mt-2"></div>
      <div id="prize-message"></div>
    </div>
  </div>
  </div>

  <script>
    const SHEET_URL = "https://opensheet.elk.sh/1CjvwFfWdEqdP_N6yxt4pRwXkZtB1T7ld7lVdEViq4FA/1";
    let sheetData = [];
    function normalizePhone(phone) {
      return phone.replace(/\D/g, "");
    }
    function getTaiwanLocalDateString() {
      const now = new Date();
      const taiwanOffset = 8 * 60; // UTC+8
      const local = new Date(now.getTime() + (taiwanOffset + now.getTimezoneOffset()) * 60000);
      return local.toISOString().split("T")[0];
    }

    function getPrizeMessage() {
      const deadlines = [
        { date: "2025-04-25", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯4/25" },
        { date: "2025-05-09", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯5/9" },
        { date: "2025-05-23", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯5/23" },
        { date: "2025-06-06", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯6/6" },
        { date: "2025-06-20", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯6/20" },
        { date: "2025-07-04", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯7/4" },
        { date: "2025-07-18", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯7/18" },
        { date: "2025-08-01", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯8/1" },
        { date: "2025-08-15", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯8/15" },
        { date: "2025-08-29", message: "æ‚¨åƒåŠ çš„é–‹çæ—¥æœŸæ˜¯8/29" },
      ];

      const todayStr = getTaiwanLocalDateString();
      
      console.log("ä»Šå¤©çš„æ—¥æœŸï¼š", todayStr); // Debugging log
      for (let i = 0; i < deadlines.length; i++) {
        if (todayStr <= deadlines[i].date) {
          return deadlines[i].message;
        }
      }

      return ""; // æ²’æœ‰å°æ‡‰æç¤º
    }



    fetch(SHEET_URL)
      .then(res => res.json())
      .then(data => {
        if (!Array.isArray(data)) {
          throw new Error("å›å‚³æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªå·¥ä½œè¡¨åç¨±");
        }
        sheetData = data;
        document.getElementById("total").textContent = sheetData.length;
      })
      .catch(err => {
        document.getElementById("total").textContent = "è®€å–å¤±æ•—";
        console.error("è³‡æ–™è¼‰å…¥éŒ¯èª¤ï¼š", err);
      });
    function search() {
      const input = document.getElementById("phone").value.trim();
      const normalizedInput = normalizePhone(input);

      // const result = sheetData.find(row => row["é›»è©±ä¸€"] === input);

      const result = normalizedInput.trim() === ""
        ? undefined
        : sheetData.find(row => normalizePhone(row["é›»è©±ä¸€"]) === normalizedInput ||
          normalizePhone(row["é›»è©±äºŒ"]) === normalizedInput);


      // const output = document.getElementById("result");
      const output = document.getElementById("query-result");
      const prize = document.getElementById("prize-message");

      if (result) {
        output.innerHTML = `
          <div class="alert alert-success">
            <p><strong>å®¢æˆ¶åç¨±ï¼š</strong>${result["å®¢æˆ¶åç¨±"]}</p>
            <p><strong>é›»è©±ä¸€ï¼š</strong>${result["é›»è©±ä¸€"]}</p>
            <p><strong>é›»è©±äºŒï¼š</strong>${result["é›»è©±äºŒ"]}</p>
            <p><strong>æŠ½çæ¬¡æ•¸ï¼š</strong>${result["æŠ½çæ¬¡æ•¸"]}</p>
          </div>
        `;

        // åŠ å…¥æç¤ºèªå¥
        const message = getPrizeMessage();
        prize.innerHTML = `
          <div class="alert alert-success">
            ${message}
          </div>
        `;

      } else {
        output.innerHTML = `
          <div class="alert alert-warning">
            æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªæ‰‹æ©Ÿè™Ÿç¢¼æ˜¯å¦æ­£ç¢ºã€‚
          </div>
        `;
        prize.innerHTML = ``;
      }
    }
  </script>
</body>

</html>