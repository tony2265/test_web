import{d as De,o as Q,r as j,C as J,j as E,D as Y,g as c,t as x,v as i,z as m,A as s,x as _,E as v,F as U,y as D,G as e,B as V,H as F,I as X,_ as we}from"./DwiSIUc-.js";import{_ as Ve,a as Ne}from"./BIYX_FZn.js";import{u as Se}from"./CIx7cVy6.js";const Ee={style:{height:"80vh"}},$e={class:"d-flex align-center justify-space-between mb-4"},Ce={class:"text-caption text-medium-emphasis ml-1"},qe={class:"text-subtitle-1 font-weight-bold mb-2"},Re={key:0,class:"text-caption text-medium-emphasis mb-4"},Ue={class:"mt-2 d-flex flex-wrap gap-2"},Ae={key:0,class:"mt-3"},je={key:9,class:"text-body-2 text-error"},Fe={key:10,class:"mt-4"},Pe={class:"text-body-2"},Le={class:"text-medium-emphasis force-blue"},Me={class:"text-body-1 force-black"},W="gform_hidden_iframe",ze="https://docs.google.com/forms/d/e/1FAIpQLSdV11zHbgNUz43VltGq5Ru0g8cq0z5VirAsJynxt7bRTyJANw/formResponse",Ie="https://docs.google.com/forms/d/e/1FAIpQLSdV11zHbgNUz43VltGq5Ru0g8cq0z5VirAsJynxt7bRTyJANw/viewform",Te="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=785231967&single=true&output=csv",Be=De({__name:"LMainPage",setup(Z){let y=null;Q(()=>{y=document.querySelector(`iframe[name="${W}"]`),y||(y=document.createElement("iframe"),y.name=W,y.style.display="none",document.body.appendChild(y))});const w=j(!1),d={manager:"entry.1337707568",phone:"entry.2038299460",project:"entry.846040466",content:"entry.1165731264",amount:"entry.1613120333",incomeName:"entry.1421557919",email:"entry.1473392007",startDate:"entry.212117856",endDate:"entry.1934135664",payDate:"entry.761706460"},P=[{name:"Evie",phone:"0955071916"},{name:"Nick",phone:"0933114874"},{name:"Tony",phone:"0903037457"}],o=J({manager:"",phone:"",project:"",content:"",amount:"",incomeName:"",email:"",startDate:"",endDate:"",payDate:""}),N=j([{key:"manager",label:"經辦人",type:"select",options:P.map(n=>n.name),entry:d.manager,required:!0,hint:"選擇後會自動帶入聯絡電話（不需輸入）"},{key:"project",label:"專案名稱",type:"text",entry:d.project,required:!0,placeholder:"例如：灯理短影音委託"},{key:"content",label:"勞務內容",type:"text",entry:d.content,required:!0,placeholder:"例如：平面設計、影音剪輯、美術繪圖"},{key:"amount",label:"支領金額",type:"number",entry:d.amount,required:!0,placeholder:"例如：500"},{key:"incomeName",label:"所得人",type:"select",source:"income",entry:d.incomeName,required:!0,hint:"可從清單選擇或自行輸入；若選清單會自動帶入 Email"},{key:"email",label:"Email",type:"text",entry:d.email,required:!0,placeholder:"例如：name@gmail.com"},{key:"startDate",label:"勞務期間（起）",type:"date",required:!0,hint:"請選擇日期"},{key:"endDate",label:"勞務期間（迄）",type:"date",required:!0,hint:"請選擇日期"},{key:"payDate",label:"付款日期",type:"date",required:!0,hint:"請選擇日期"}]),u=J({});function L(n,t){u[n]=t}function k(n){u[n]=""}const b=j(0),M=E(()=>b.value===N.value.length),a=E(()=>N.value[b.value]),K=E(()=>Math.round(b.value/N.value.length*100)),$=J({show:!1,text:"",color:"success"});function C(n,t="success"){$.text=n,$.color=t,$.show=!0}function ee(n){const t=n.split(/\r?\n/).map(p=>p.trim()).filter(Boolean);if(t.length<2)return[];const r=t[0].split(",").map(p=>p.trim());return t.slice(1).map(p=>{const S=p.split(",").map(h=>h.trim()),f={};return r.forEach((h,q)=>f[h]=S[q]??""),f})}const z=j(!1),A=j([]);async function te(){z.value=!0;try{const n=await fetch(Te).then(r=>r.text()),t=ee(n);A.value=t.filter(r=>r.name).map(r=>({name:r.name,email:r.email??""}))}finally{z.value=!1}}Q(()=>{te().catch(console.error)}),Y(()=>o.manager,n=>{const t=P.find(r=>r.name===n);o.phone=(t==null?void 0:t.phone)??""}),Y(()=>o.incomeName,n=>{const t=A.value.find(r=>r.name===n);t&&(o.email=t.email??"")});const O=E(()=>o.incomeName?A.value.some(n=>n.name===o.incomeName):!1);function oe(){const n=A.value.find(t=>t.name===o.incomeName);n&&(o.email=n.email??"")}function ne(){o.email.includes("@")||(o.email+="@gmail.com")}function T(n){return n.options?n.options:n.source==="income"?A.value.map(t=>t.name):[]}function ae(){const n=a.value;if(!n)return!0;if(!n.required)return k(n.key),!0;const t=String(o[n.key]??"").trim();if(!t)return L(n.key,`「${n.label}」為必填，請先填寫`),C(`請先填寫：${n.label}`,"error"),!1;if(n.key==="amount"){const r=Number(t);if(!Number.isFinite(r)||r<0)return L(n.key,"支領金額需為正整數"),C("支領金額格式不正確","error"),!1}return k(n.key),!0}function re(){ae()&&b.value<N.value.length&&(b.value+=1)}function le(){b.value>0&&(b.value-=1)}function B(n){return n||""}const se=E(()=>[{cols:[{label:"經辦人",value:o.manager}]},{cols:[{label:"聯絡電話",value:o.phone}]},{cols:[{label:"專案名稱",value:o.project}]},{cols:[{label:"勞務內容",value:o.content}]},{cols:[{label:"支領金額",value:o.amount}]},{cols:[{label:"所得人",value:o.incomeName}]},{cols:[{label:"Email",value:o.email}]},{cols:[{label:"勞務期間（起）",value:B(o.startDate)}]},{cols:[{label:"勞務期間（迄）",value:B(o.endDate)}]},{cols:[{label:"付款日期",value:B(o.payDate)}]}]),ie=E(()=>["manager","project","content","amount","incomeName","email","startDate","endDate","payDate"]),me=E(()=>{const n={manager:"經辦人",project:"專案名稱",content:"勞務內容",amount:"支領金額",incomeName:"所得人",email:"Email",startDate:"勞務期間（起）",endDate:"勞務期間（迄）",payDate:"付款日期"},t=[];for(const r of ie.value)String(o[r]??"").trim()||t.push(n[r]??r);return t}),de=E(()=>me.value.length===0);function ue(){if(!de.value){C("欄位未填完整","error");return}if(!y){C("系統尚未初始化完成，請稍後再試一次","error");return}w.value=!0;const n=document.createElement("form");n.method="POST",n.action=ze,n.target=y.name,n.style.display="none";function t(p,S){const f=document.createElement("input");f.type="hidden",f.name=p,f.value=S,n.appendChild(f)}t(d.manager,o.manager),t(d.project,o.project),t(d.content,o.content),t(d.amount,o.amount),t(d.incomeName,o.incomeName),t(d.email,o.email),o.phone&&t(d.phone,o.phone);function r(p,S){if(!S)return;const[f,h,q]=S.split("-").map(R=>Number(R));!f||!h||!q||(t(`${p}_year`,String(f)),t(`${p}_month`,String(h)),t(`${p}_day`,String(q)))}r(d.startDate,o.startDate),r(d.endDate,o.endDate),r(d.payDate,o.payDate);const g=()=>{y==null||y.removeEventListener("load",g),C("已送出（若表單限制登入/權限，可能仍會失敗）","success"),ce(),w.value=!1,n.remove()};y.addEventListener("load",g),document.body.appendChild(n),n.requestSubmit?n.requestSubmit():n.submit(),setTimeout(()=>{w.value&&(y==null||y.removeEventListener("load",g),C("送出可能被瀏覽器或表單權限擋下，請改用「開啟表單」確認","warning"),w.value=!1,n.remove())},6e3)}function ce(){o.manager="",o.phone="",o.project="",o.content="",o.amount="",o.incomeName="",o.email="",o.startDate="",o.endDate="",o.payDate="",b.value=0}function pe(){const n=new URLSearchParams;n.set("usp","pp_url");for(const r of N.value){if(!r.entry||r.type==="date")continue;const g=String(o[r.key]??"").trim();g&&n.set(r.entry,g)}o.phone&&n.set(d.phone,o.phone);function t(r,g){if(!g)return;const p=new Date(g);Number.isNaN(p.getTime())||(n.set(`${r}_year`,String(p.getFullYear())),n.set(`${r}_month`,String(p.getMonth()+1)),n.set(`${r}_day`,String(p.getDate())))}return t(d.startDate,o.startDate),t(d.endDate,o.endDate),t(d.payDate,o.payDate),`${Ie}?${n.toString()}`}function ye(){const n=pe();window.open(n,"_blank")}return(n,t)=>{const r=c("v-chip"),g=c("v-progress-linear"),p=c("v-select"),S=c("v-combobox"),f=c("v-text-field"),h=c("v-alert"),q=c("v-textarea"),R=c("v-col"),G=c("v-row"),fe=c("v-list-item"),ve=c("v-list"),ge=c("v-card"),_e=c("v-snackbar"),I=c("v-btn"),ke=c("v-footer"),be=c("v-container");return i(),x("div",Ee,[m(G,{class:"fill-height",align:"center",justify:"center","no-gutters":""},{default:s(()=>[m(R,{cols:"12",sm:"10",md:"8",lg:"6"},{default:s(()=>[m(be,{class:"py-6"},{default:s(()=>[_("div",$e,[_("div",null,[t[18]||(t[18]=_("div",{class:"text-h6 font-weight-bold"},"勞報單生成 / DreamCity",-1)),_("div",Ce,D(e(b)+1)+" / "+D(e(N).length+1),1)]),e(M)?(i(),v(r,{key:0,color:"primary",variant:"flat"},{default:s(()=>t[19]||(t[19]=[V(" 已完成 ")])),_:1})):U("",!0)]),m(g,{"model-value":e(K),height:"8",rounded:"",color:"primary","bg-color":"primary-lighten-4",class:"mb-4"},null,8,["model-value"]),m(ge,{rounded:"md",class:"pa-0 elevation-0"},{default:s(()=>[e(M)?(i(),x(F,{key:1},[m(ve,{density:"compact",class:"elevation-2 ma-1"},{default:s(()=>[(i(!0),x(F,null,X(e(se),(l,he)=>(i(),v(fe,{key:he},{default:s(()=>[m(G,{dense:""},{default:s(()=>[(i(!0),x(F,null,X(l.cols,(H,xe)=>(i(),v(R,{key:xe,cols:"12"},{default:s(()=>[_("div",Pe,[_("span",Le,D(H.label),1)]),_("div",Me,D(H.value||"（空）"),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),m(h,{class:"mt-4",variant:"tonal",type:"warning",density:"compact"},{default:s(()=>t[24]||(t[24]=[V(" 確認內容無誤後，點「直接送出」即可完成勞報申請。 ")])),_:1})],64)):(i(),x(F,{key:0},[_("div",qe,D(e(a).label),1),e(a).hint?(i(),x("div",Re,D(e(a).hint),1)):U("",!0),e(a).key==="manager"?(i(),v(p,{key:1,items:T(e(a)),modelValue:e(o).manager,"onUpdate:modelValue":[t[0]||(t[0]=l=>e(o).manager=l),t[1]||(t[1]=l=>k(e(a).key))],placeholder:"請選擇經辦人",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["items","modelValue","error","error-messages"])):e(a).key==="incomeName"?(i(),v(S,{key:2,modelValue:e(o).incomeName,"onUpdate:modelValue":[t[2]||(t[2]=l=>e(o).incomeName=l),t[3]||(t[3]=l=>k(e(a).key))],items:T(e(a)),placeholder:"選擇或自行輸入所得人",variant:"outlined",density:"comfortable","hide-details":"auto",loading:e(z),error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","items","loading","error","error-messages"])):e(a).key==="email"?(i(),x(F,{key:3},[m(f,{modelValue:e(o).email,"onUpdate:modelValue":[t[4]||(t[4]=l=>e(o).email=l),t[5]||(t[5]=l=>k(e(a).key))],placeholder:"例如：name@gmail.com",variant:"outlined",density:"comfortable","hide-details":"auto",clearable:"",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","error","error-messages"]),_("div",Ue,[m(r,{size:"small",variant:"outlined",class:"cursor-pointer",onClick:ne},{default:s(()=>t[20]||(t[20]=[V(" @gmail.com ")])),_:1}),e(O)?(i(),v(r,{key:0,size:"small",variant:"tonal",color:"primary",class:"cursor-pointer",onClick:oe},{default:s(()=>t[21]||(t[21]=[V(" 重新帶入 Email ")])),_:1})):U("",!0)]),e(O)?(i(),x("div",Ae,[m(h,{variant:"tonal",type:"info",density:"compact"},{default:s(()=>[t[22]||(t[22]=V(" 已自動帶入所得人 Email：")),_("b",null,D(e(o).email||"（空）"),1)]),_:1})])):U("",!0)],64)):e(a).type==="date"?(i(),v(f,{key:4,modelValue:e(o)[e(a).key],"onUpdate:modelValue":[t[6]||(t[6]=l=>e(o)[e(a).key]=l),t[7]||(t[7]=l=>k(e(a).key))],type:"date",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","error","error-messages"])):e(a).type==="select"?(i(),v(p,{key:5,items:T(e(a)),modelValue:e(o)[e(a).key],"onUpdate:modelValue":[t[8]||(t[8]=l=>e(o)[e(a).key]=l),t[9]||(t[9]=l=>k(e(a).key))],placeholder:e(a).placeholder||"請選擇",disabled:e(a).disabled,loading:e(a).source?e(z):!1,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["items","modelValue","placeholder","disabled","loading","error","error-messages"])):e(a).type==="text"?(i(),v(f,{key:6,modelValue:e(o)[e(a).key],"onUpdate:modelValue":[t[10]||(t[10]=l=>e(o)[e(a).key]=l),t[11]||(t[11]=l=>k(e(a).key))],placeholder:e(a).placeholder||"請輸入",readonly:e(a).readonly,disabled:e(a).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","placeholder","readonly","disabled","error","error-messages"])):e(a).type==="number"?(i(),v(f,{key:7,modelValue:e(o)[e(a).key],"onUpdate:modelValue":[t[12]||(t[12]=l=>e(o)[e(a).key]=l),t[13]||(t[13]=l=>k(e(a).key))],type:"number",inputmode:"numeric",placeholder:e(a).placeholder||"請輸入數字",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","placeholder","error","error-messages"])):e(a).type==="textarea"?(i(),v(q,{key:8,modelValue:e(o)[e(a).key],"onUpdate:modelValue":[t[14]||(t[14]=l=>e(o)[e(a).key]=l),t[15]||(t[15]=l=>k(e(a).key))],placeholder:e(a).placeholder||"請輸入",variant:"outlined",density:"comfortable",rows:"3","auto-grow":"","hide-details":"auto",error:!!e(u)[e(a).key],"error-messages":e(u)[e(a).key]},null,8,["modelValue","placeholder","error","error-messages"])):(i(),x("div",je," 未支援的輸入類型："+D(e(a).type),1)),e(a).key==="manager"&&e(o).phone?(i(),x("div",Fe,[m(h,{variant:"tonal",type:"info",density:"compact"},{default:s(()=>[t[23]||(t[23]=V(" 已自動帶入聯絡電話：")),_("b",null,D(e(o).phone),1)]),_:1})])):U("",!0)],64))]),_:1}),m(_e,{modelValue:e($).show,"onUpdate:modelValue":t[16]||(t[16]=l=>e($).show=l),color:e($).color,timeout:"2500",location:"bottom"},{default:s(()=>[V(D(e($).text),1)]),_:1},8,["modelValue","color"]),m(ke,{app:"",elevation:"6",class:"pa-0"},{default:s(()=>[m(G,{"no-gutters":"",class:"w-100"},{default:s(()=>[m(R,{cols:"3"},{default:s(()=>[m(I,{block:"",height:n.$vuetify.display.smAndDown?72:56,variant:"tonal",class:"rounded-0",disabled:e(b)===0,icon:"mdi-chevron-left",onClick:le},null,8,["height","disabled"])]),_:1}),m(R,{cols:"9",class:"d-flex align-stretch"},{default:s(()=>[e(M)?(i(),v(I,{key:1,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:n.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat",loading:e(w),disabled:e(w),"append-icon":"mdi-send",onClick:ue},{default:s(()=>t[26]||(t[26]=[V(" 直接送出 ")])),_:1},8,["height","loading","disabled"])):(i(),v(I,{key:0,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:n.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat","append-icon":"mdi-chevron-right",onClick:t[17]||(t[17]=l=>re())},{default:s(()=>t[25]||(t[25]=[V(" 下一步 ")])),_:1},8,["height"])),e(M)?(i(),v(I,{key:2,class:"rounded-0",height:n.$vuetify.display.smAndDown?72:56,width:"72",variant:"tonal",color:"primary",icon:"mdi-open-in-new",onClick:ye},null,8,["height"])):U("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}}),Ge=we(Be,[["__scopeId","data-v-c73a8c8e"]]),Je={class:"d-flex align-center justify-center"},Ye={__name:"labor",setup(Z){return Se({title:"勞報單生成 | 夢想之都工作室"}),(y,w)=>{const d=Ge,P=Ne,o=c("v-progress-circular"),N=c("v-container"),u=Ve,L=c("v-main"),k=c("v-app");return i(),v(k,null,{default:s(()=>[m(L,null,{default:s(()=>[m(u,null,{fallback:s(()=>[m(N,{class:"py-10",style:{"max-width":"520px"}},{default:s(()=>[_("div",Je,[m(o,{indeterminate:""}),w[0]||(w[0]=_("div",{class:"text-body-2 text-medium-emphasis ms-3"},"載入中…",-1))])]),_:1})]),default:s(()=>[m(P,{pin:"0919","storage-key":"cashier_pin_ok"},{default:s(()=>[m(d)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ye as default};
