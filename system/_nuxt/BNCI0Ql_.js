import{r as R,d as Re,C as H,j as U,o as Me,D as oe,g as m,E as C,v as p,A as u,z as c,x as g,F as D,y as x,G as e,B as P,t as V,H as E,I as z,_ as Ie}from"./kOEfD73y.js";import{u as Ne}from"./BLy3hhev.js";function $e(h="hidden_iframe"){let f=document.getElementById(h);return f||(f=document.createElement("iframe"),f.name=h,f.id=h,f.style.display="none",document.body.appendChild(f)),f}function Ee(h,f){const v=document.createElement("form");return v.action=h,v.method="POST",v.target=f,v.style.display="none",v}function W(h,f,v){const w=document.createElement("input");w.type="hidden",w.name=f,w.value=v??"",h.appendChild(w)}function Ae(){const h=R(!1),f=R(!1),v=R(null);async function w(b,k){var n;h.value=!0,f.value=!1,v.value=null;try{const l=$e("hidden_iframe"),_=Ee(k.formPostUrl,"hidden_iframe");W(_,"usp","pp_url");for(const y of k.steps){if(!y.entry)continue;const s=(b[y.key]??"").trim();s&&W(_,y.entry,s)}const S=((n=k.getExtraFields)==null?void 0:n.call(k))??[];for(const y of S){const s=(y.value??"").trim();s&&W(_,y.name,s)}await new Promise(y=>{const s=()=>{l.removeEventListener("load",s),y()};l.addEventListener("load",s),document.body.appendChild(_),_.submit(),_.remove()}),f.value=!0}catch(l){v.value=(l==null?void 0:l.message)??String(l)}finally{h.value=!1}}function A(b,k,n,l){const _=new URLSearchParams;_.set("usp","pp_url");for(const y of n){if(!y.entry)continue;const s=(k[y.key]??"").trim();s&&_.set(y.entry,s)}const S=(l==null?void 0:l())??[];for(const y of S){const s=(y.value??"").trim();s&&_.set(y.name,s)}return`${b}?${_.toString()}`}return{submitting:h,submitOk:f,submitError:v,submitDirect:w,buildPrefilledUrl:A}}const Fe={class:"d-flex align-center justify-space-between mb-4"},qe={class:"text-caption text-medium-emphasis ml-1"},De={class:"text-subtitle-1 font-weight-bold mb-2"},Oe={key:0,class:"text-caption text-medium-emphasis mb-4"},Be={class:"mt-3 d-flex flex-wrap gap-2"},Le={key:7,class:"text-body-2 text-error"},Te={key:8,class:"mt-4"},je={key:9,class:"mt-4"},Je={class:"text-body-2"},Qe={class:"text-medium-emphasis force-blue"},Ye={class:"text-body-1 force-black"},Ge="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/formResponse",He="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=0&single=true&output=csv",ze="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=691371121&single=true&output=csv",We="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/viewform",Xe=Re({__name:"OMainPage",setup(h){const{submitting:f,submitOk:v,submitError:w,submitDirect:A}=Ae(),b={applicant:"entry.227203665",budgetCode:"entry.798019421",amount:"entry.781561663",purpose:"entry.911688229",payee:"entry.1906095594",payMethod:"entry.93780387",payInfo:"entry.627391982",payProof:"entry.1651297620"},k=R([{key:"applicant",label:"申請人",type:"select",options:["嗡嗡","Nick","CB","Rice"],entry:b.applicant,required:!0},{key:"budgetName",label:"預算名稱",type:"select",source:"budgets",hint:"選名稱後會自動帶入「預算編號」",required:!0},{key:"amount",label:"金額",type:"number",entry:b.amount,placeholder:"例如：4000",required:!0},{key:"purpose",label:"用途",type:"text",entry:b.purpose,placeholder:"",required:!0},{key:"payee",label:"付款對象",type:"select",source:"payees",entry:b.payee,hint:"可從清單選擇，或直接輸入自訂名稱（仍可手動修改）",required:!0},{key:"payMethod",label:"付款方式",type:"select",options:["匯款","現金","代墊"],entry:b.payMethod,required:!0},{key:"payInfo",label:"付款資訊",type:"text",entry:b.payInfo,placeholder:"(銀行代碼) 匯款帳號",required:!1},{key:"payProof",label:"付款憑證",type:"select",options:["勞報單","電子發票","紙本發票(發票機統一發票、三聯式發票)","收據、免用統一發票收據","無須付款憑證(米畫師)","無須付款憑證(Steam)","無須付款憑證(NYCU)","無須付款憑證(其他，需於申請時補充於頻道)"],entry:b.payProof,required:!0}]),n=H({applicant:"",budgetName:"",budgetCode:"",amount:"",purpose:"",payee:"",payMethod:"",payInfo:"",payProof:""}),l=H({});function _(o,t){l[o]=t}function S(o){l[o]=""}function y(){const o=r.value;if(!o)return!0;if(!o.required)return S(o.key),!0;const t=(n[o.key]??"").trim();if(!t)return _(o.key,`「${o.label}」為必填，請先填寫`),N(`請先填寫：${o.label}`,"error"),!1;if(o.key==="budgetName"&&!(n.budgetCode??"").trim())return _(o.key,"此預算名稱尚未帶入預算編號，請確認清單資料或重新選擇"),N("預算名稱尚未帶入預算編號","error"),!1;if(o.key==="amount"){const i=Number(t);if(!Number.isFinite(i)||i<0)return _(o.key,"金額需為正整數"),N("金額格式不正確","error"),!1}return S(o.key),!0}const s=R(0),O=U(()=>s.value===k.value.length),r=U(()=>k.value[s.value]),ne=U(()=>Math.round(s.value/k.value.length*100)),j=R(!1),J=R([]),B=R([]),re=["嘟比","灯理","煦","妮酷","陳旭元","OP","ED","PV","Teaser","Cover","精華剪輯","混音","美術圖","Q版圖","動態","製作","Google廣告","中之人報酬","季結算","分潤","營業稅"],Q=U({get:()=>n.purpose??"",set:o=>n.purpose=o});function le(o){const t=(Q.value||"").trim();t.includes(o)||(Q.value=t?`${t}${o}`:o)}function ae(){Q.value=""}function X(o){const t=o.split(/\r?\n/).map(d=>d.trim()).filter(Boolean);if(t.length<2)return[];const i=t[0].split(",").map(d=>d.trim());return t.slice(1).map(d=>{const Y=d.split(",").map(F=>F.trim()),$={};return i.forEach((F,q)=>$[F]=Y[q]??""),$})}async function se(){j.value=!0;try{const[o,t]=await Promise.all([fetch(He).then(d=>d.text()),fetch(ze).then(d=>d.text())]),i=X(o),M=X(t);J.value=i.filter(d=>d.name).map(d=>({name:d.name,code:d.code})),B.value=M.filter(d=>d.name).map(d=>({name:d.name,method:d.method??"",info:d.info??"",proof:d.proof??""}))}finally{j.value=!1}}Me(()=>{se().catch(console.error)}),oe(()=>n.budgetName,o=>{if(!o){n.budgetCode="";return}const t=J.value.find(i=>i.name===o);t&&(n.budgetCode=t.code||"")}),oe(()=>n.payee,o=>{if(!o){n.payMethod="",n.payInfo="",n.payProof="";return}const t=B.value.find(i=>i.name===o);if(!t){n.payMethod="",n.payInfo="",n.payProof="";return}n.payMethod=t.method||"",n.payInfo=t.info||"",n.payProof=t.proof||""});const ue=U(()=>n.payee?B.value.some(o=>o.name===n.payee):!1);function K(o){return o.options?o.options:o.source==="budgets"?J.value.map(t=>t.name):o.source==="payees"?B.value.map(t=>t.name):[]}function ie(){y()&&s.value<k.value.length&&(s.value+=1)}function de(){s.value>0&&(s.value-=1)}const pe=U(()=>[{cols:[{label:"申請人",value:n.applicant}]},{cols:[{label:"預算編號",value:n.budgetName}]},{cols:[{label:"金額",value:n.amount}]},{cols:[{label:"用途",value:n.purpose}]},{cols:[{label:"付款對象",value:n.payee}]},{cols:[{label:"付款方式",value:n.payMethod},{label:"付款資訊",value:n.payInfo}]},{cols:[{label:"付款憑證",value:n.payProof}]}]),Z=R(!1),ce=U(()=>["applicant","budgetName","budgetCode","amount","purpose","payee","payMethod","payProof"]),me=U(()=>{const o={applicant:"申請人",budgetName:"預算名稱",budgetCode:"預算編號",amount:"金額",purpose:"用途",payee:"付款對象",payMethod:"付款方式",payProof:"付款憑證"},t=[];for(const i of ce.value)(n[i]??"").trim()||t.push(o[i]??i);return t}),fe=U(()=>me.value.length===0);async function ye(){if(Z.value=!0,!fe.value){N("欄位未填完整，無法送出（付款資訊可留白）","error");return}await ke(),v.value?(N("已成功送出，表單已清空","success"),ve()):N(w.value?`送出失敗：${w.value}`:"送出失敗","error")}const I=H({show:!1,text:"",color:"success"});function N(o,t="success"){I.text=o,I.color=t,I.show=!0}function ve(){for(const o of Object.keys(n))n[o]="";s.value=0,Z.value=!1,typeof v<"u"&&(v.value=!1),typeof w<"u"&&(w.value=null)}function be(){const o=new URLSearchParams;o.set("usp","pp_url");const t=(n.budgetCode??"").trim();t&&o.set(b.budgetCode,t);for(const i of k.value){if(!i.entry||i.key==="budgetCode")continue;const M=(n[i.key]??"").trim();M&&o.set(i.entry,M)}return`${We}?${o.toString()}`}function ge(){const o=be();window.open(o,"_blank")}function ke(){return A(n,{formPostUrl:Ge,entryMap:b,steps:k.value,getExtraFields:()=>{const o=[],t=(n.budgetCode??"").trim();return t&&o.push({name:b.budgetCode,value:t}),o}})}return(o,t)=>{const i=m("v-chip"),M=m("v-progress-linear"),d=m("v-combobox"),Y=m("v-select"),$=m("v-text-field"),F=m("v-textarea"),q=m("v-alert"),L=m("v-col"),G=m("v-row"),_e=m("v-list-item"),he=m("v-list"),we=m("v-card"),xe=m("v-snackbar"),T=m("v-btn"),Ce=m("v-footer"),Se=m("v-container"),Pe=m("v-main"),Ve=m("v-app");return p(),C(Ve,null,{default:u(()=>[c(Pe,null,{default:u(()=>[c(G,{class:"fill-height",align:"center",justify:"center","no-gutters":""},{default:u(()=>[c(L,{cols:"12",sm:"10",md:"8",lg:"6"},{default:u(()=>[c(Se,{class:"py-6"},{default:u(()=>[g("div",Fe,[g("div",null,[t[14]||(t[14]=g("div",{class:"text-h6 font-weight-bold"},"出帳表單 / DreamCity",-1)),g("div",qe,x(e(s)+1)+" / "+x(e(k).length+1),1)]),e(O)?(p(),C(i,{key:0,color:"primary",variant:"flat"},{default:u(()=>t[15]||(t[15]=[P(" 已完成 ")])),_:1})):D("",!0)]),c(M,{"model-value":e(ne),height:"8",rounded:"",color:"primary","bg-color":"primary-lighten-4",class:"mb-4"},null,8,["model-value"]),c(we,{rounded:"md",class:"pa-0 elevation-0"},{default:u(()=>[e(O)?(p(),V(E,{key:1},[c(he,{density:"compact",class:"elevation-2 ma-1"},{default:u(()=>[(p(!0),V(E,null,z(e(pe),(a,ee)=>(p(),C(_e,{key:ee},{default:u(()=>[c(G,{dense:""},{default:u(()=>[(p(!0),V(E,null,z(a.cols,(te,Ue)=>(p(),C(L,{key:Ue,cols:"12"},{default:u(()=>[g("div",Je,[g("span",Qe,x(te.label),1)]),g("div",Ye,x(te.value||"（空）"),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),c(q,{class:"mt-4",variant:"tonal",type:"warning",density:"compact"},{default:u(()=>t[25]||(t[25]=[P(" 確認內容無誤，生成後，請在 Google 表單按下「送出」方可完成申請。 ")])),_:1})],64)):(p(),V(E,{key:0},[g("div",De,x(e(r).label),1),e(r).hint?(p(),V("div",Oe,x(e(r).hint),1)):D("",!0),e(r).key==="payee"?(p(),C(d,{key:1,modelValue:e(n).payee,"onUpdate:modelValue":[t[0]||(t[0]=a=>e(n).payee=a),t[1]||(t[1]=a=>S(e(r).key))],items:K(e(r)),placeholder:"選擇或自行輸入付款對象",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["modelValue","items","error","error-messages"])):e(r).type==="select"?(p(),C(Y,{key:2,items:K(e(r)),modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[2]||(t[2]=a=>e(n)[e(r).key]=a),t[3]||(t[3]=a=>S(e(r).key))],placeholder:e(r).placeholder||"請選擇",disabled:e(r).disabled,loading:e(r).source?e(j):!1,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["items","modelValue","placeholder","disabled","loading","error","error-messages"])):e(r).key==="purpose"?(p(),V(E,{key:3},[c($,{modelValue:e(n).purpose,"onUpdate:modelValue":[t[4]||(t[4]=a=>e(n).purpose=a),t[5]||(t[5]=a=>S(e(r).key))],placeholder:e(r).placeholder||"例如：灯理PV製作",readonly:e(r).readonly,disabled:e(r).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",clearable:"",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["modelValue","placeholder","readonly","disabled","error","error-messages"]),g("div",Be,[(p(),V(E,null,z(re,a=>c(i,{key:a,size:"small",variant:"outlined",class:"cursor-pointer",onClick:ee=>le(String(a))},{default:u(()=>[P(x(a),1)]),_:2},1032,["onClick"])),64)),c(i,{size:"small",variant:"tonal",color:"error",class:"cursor-pointer",onClick:ae},{default:u(()=>t[16]||(t[16]=[P(" 清空 ")])),_:1})])],64)):e(r).type==="text"?(p(),C($,{key:4,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[6]||(t[6]=a=>e(n)[e(r).key]=a),t[7]||(t[7]=a=>S(e(r).key))],placeholder:e(r).placeholder||"請輸入",readonly:e(r).readonly,disabled:e(r).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["modelValue","placeholder","readonly","disabled","error","error-messages"])):e(r).type==="number"?(p(),C($,{key:5,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[8]||(t[8]=a=>e(n)[e(r).key]=a),t[9]||(t[9]=a=>S(e(r).key))],type:"number",inputmode:"numeric",placeholder:e(r).placeholder||"請輸入數字",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["modelValue","placeholder","error","error-messages"])):e(r).type==="textarea"?(p(),C(F,{key:6,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[10]||(t[10]=a=>e(n)[e(r).key]=a),t[11]||(t[11]=a=>S(e(r).key))],placeholder:e(r).placeholder||"請輸入",variant:"outlined",density:"comfortable",rows:"3","auto-grow":"","hide-details":"auto",error:!!e(l)[e(r).key],"error-messages":e(l)[e(r).key]},null,8,["modelValue","placeholder","error","error-messages"])):(p(),V("div",Le," 未支援的輸入類型："+x(e(r).type),1)),e(r).key==="budgetName"&&e(n).budgetCode?(p(),V("div",Te,[c(q,{variant:"tonal",type:"info",density:"compact"},{default:u(()=>[t[17]||(t[17]=P(" 已自動帶入「預算編號」：")),g("b",null,x(e(n).budgetCode),1)]),_:1})])):D("",!0),e(r).key==="payee"&&e(ue)?(p(),V("div",je,[c(q,{variant:"tonal",type:"info",density:"compact"},{default:u(()=>[t[18]||(t[18]=P(" 已自動帶入：")),t[19]||(t[19]=g("br",null,null,-1)),t[20]||(t[20]=P(" 付款方式：")),g("b",null,x(e(n).payMethod||"（空）"),1),t[21]||(t[21]=g("br",null,null,-1)),t[22]||(t[22]=P(" 付款資訊：")),g("b",null,x(e(n).payInfo||"（空）"),1),t[23]||(t[23]=g("br",null,null,-1)),t[24]||(t[24]=P(" 付款憑證：")),g("b",null,x(e(n).payProof||"（空）"),1)]),_:1})])):D("",!0)],64))]),_:1}),c(xe,{modelValue:e(I).show,"onUpdate:modelValue":t[12]||(t[12]=a=>e(I).show=a),color:e(I).color,timeout:"2500",location:"bottom"},{default:u(()=>[P(x(e(I).text),1)]),_:1},8,["modelValue","color"]),c(Ce,{app:"",elevation:"6",class:"pa-0"},{default:u(()=>[c(G,{"no-gutters":"",class:"w-100"},{default:u(()=>[c(L,{cols:"3"},{default:u(()=>[c(T,{block:"",height:o.$vuetify.display.smAndDown?72:56,variant:"tonal",class:"rounded-0",disabled:e(s)===0,icon:"mdi-chevron-left",onClick:de},null,8,["height","disabled"])]),_:1}),c(L,{cols:"9",class:"d-flex align-stretch"},{default:u(()=>[e(O)?(p(),C(T,{key:1,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:o.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat",loading:e(f),disabled:e(f),"append-icon":"mdi-send",onClick:ye},{default:u(()=>t[27]||(t[27]=[P(" 直接送出 ")])),_:1},8,["height","loading","disabled"])):(p(),C(T,{key:0,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:o.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat","append-icon":"mdi-chevron-right",onClick:t[13]||(t[13]=a=>ie())},{default:u(()=>t[26]||(t[26]=[P(" 下一步 ")])),_:1},8,["height"])),e(O)?(p(),C(T,{key:2,class:"rounded-0",height:o.$vuetify.display.smAndDown?72:56,width:"72",variant:"tonal",color:"primary",icon:"mdi-open-in-new",onClick:ge},null,8,["height"])):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Ke=Ie(Xe,[["__scopeId","data-v-4279b235"]]),tt={__name:"out",setup(h){return Ne({title:"出帳表單 | 夢想之都工作室"}),(f,v)=>{const w=Ke,A=m("v-main"),b=m("v-app");return p(),C(b,null,{default:u(()=>[c(A,null,{default:u(()=>[c(w)]),_:1})]),_:1})}}};export{tt as default};
