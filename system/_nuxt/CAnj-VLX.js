import{d as z,r as h,C as U,o as X,g as l,E as y,v,A as s,z as a,x as n,F as $,t as Z,y as u,G as c,B as p,I as Q,H as W,_ as ee}from"./kOEfD73y.js";import{_ as te,a as ne}from"./DZY8MlWj.js";import{u as oe}from"./BLy3hhev.js";const se={class:"d-flex align-center justify-space-between mb-3"},ae={class:"text-caption text-medium-emphasis"},re={class:"d-flex align-center justify-space-between mb-2"},le={class:"text-caption text-medium-emphasis"},ce={class:"d-flex align-center flex-wrap gap-2 mb-2"},ie={class:"text-subtitle-1 font-weight-bold"},de={class:"d-flex align-center flex-wrap gap-2 mb-2"},ue={class:"text-subtitle-1 font-weight-bold"},me={class:"d-flex align-center flex-wrap gap-2 mb-2"},pe={class:"text-subtitle-1 font-weight-bold"},_e={class:"d-flex align-center flex-wrap gap-2 mb-2"},fe={class:"text-body-2"},ve={class:"mb-2"},ge={class:"d-flex flex-wrap gap-2 mt-3"},xe={class:"d-flex justify-end"},he="https://docs.google.com/spreadsheets/d/e/2PACX-1vRgNPBOEVtc997aMMVBvOSdYjVUDZwXL6RwU2PLWsKkmOo6G2HZ12JlicNkv0fqg8deOo4rDLKL1Jr0/pub?gid=2137698376&single=true&output=csv",P="https://script.google.com/macros/s/AKfycbwu3KGq6KRcDmx7DJy4ZI3x2FYwu4Kq2V2l3q5kyiFJthTyuQWdhosBGZyo15KBw8NYyQ/exec",E="wV1a4cHq2t1AxKHNCPCXiNNLBtNsSSx6",ye=z({__name:"CMainPage",setup(K){const w=h(new Set);function b(t){return String(t??"").replace(/^\uFEFF/,"").replace(/^"|"$/g,"").trim().replace(/[ï¼â€“â€”]/g,"-")}async function B(){try{const e=(await fetch(he,{cache:"no-store"}).then(o=>o.text())).split(/\r?\n/).map(o=>b(o.split(",")[0])).filter(Boolean);w.value=new Set(e),console.log("bank csv sample:",e.slice(0,20)),console.log("has 2-4-9?",w.value.has("2-4-9"))}catch(t){console.error("è®€å–éŠ€è¡Œé ç®—æ¸…å–®å¤±æ•—",t),w.value=new Set}}function C(t){const e=b(t);return e&&w.value.has(e)?"å¯Œé‚¦":"è¯å—"}const m=h([]),g=h(!1),x=h(""),k=h(!1),_=U({}),N=h(null),S=U({show:!1,text:""});function f(t){S.text=t,S.show=!0}async function O(t){const e=await $fetch(t,{method:"GET"});if(typeof e=="string")try{return JSON.parse(e)}catch{throw new Error(`GAS å›å‚³é JSONï¼š${e.slice(0,200)}`)}return e}async function A(){g.value=!0,x.value="";try{const t=new URL(P);t.searchParams.set("action","pending"),t.searchParams.set("key",E);const e=await O(t.toString());if((e==null?void 0:e.error)==="Unauthorized")throw new Error("æœªæˆæ¬Šï¼šè«‹ç¢ºèª gasKey æ˜¯å¦æ­£ç¢ºã€ä¸”å·²è¢«æ‰“åŒ…é€²å‰ç«¯ï¼ˆNUXT_PUBLIC_...ï¼‰");if(!Array.isArray(e))throw console.error("pending response unexpected:",e),new Error(`GAS å›å‚³æ ¼å¼éŒ¯èª¤ï¼š${JSON.stringify(e).slice(0,200)}`);m.value=e;for(const o of m.value)_[o.row]===void 0&&(_[o.row]="")}catch(t){x.value=(t==null?void 0:t.message)||"è¼‰å…¥å¤±æ•—",m.value=[]}finally{g.value=!1,k.value=!0}}function R(t){const e=String(t??"").trim();if(!e)return"";const o=e.replace(/\s+/g," ").trim();{const d=o.match(/éŠ€è¡Œä»£ç¢¼\s*[0-9]{3}\s*([0-9][0-9\- ]{5,})/i);if(d)return d[1].replace(/[^0-9]/g,"")}{const d=o.match(/\(?\s*[0-9]{3}\s*\)?\s*[-)]\s*([0-9][0-9\- ]{5,})/);if(d)return d[1].replace(/[^0-9]/g,"")}{const d=o.match(/[0-9]{3}\s*[-â€“â€”]\s*([0-9][0-9\- ]{5,})/);if(d)return d[1].replace(/[^0-9]/g,"")}const i=o.replace(/[^0-9]/g,"");return i.length>=8?i:""}async function J(t){const e=R(t);if(!e){f("é€™ç­†ä»˜æ¬¾è³‡è¨Šæ²’æœ‰å¯è¤‡è£½çš„ã€Œå¸³è™Ÿã€");return}try{await navigator.clipboard.writeText(e),f(`å·²è¤‡è£½å¸³è™Ÿï¼š${e}`)}catch{f("è¤‡è£½å¤±æ•—ï¼ˆç€è¦½å™¨é™åˆ¶ï¼‰")}}async function T(t){const e=(_[t]??"").toString().trim();if(e===""){f("è«‹å…ˆå¡«å¯«æ‰‹çºŒè²»ï¼ˆå¯å¡« 0ï¼‰");return}const o=Number(e);if(Number.isNaN(o)||o<0){f("æ‰‹çºŒè²»éœ€ç‚º 0 ä»¥ä¸Šçš„æ•¸å­—");return}N.value=t;try{const i=new URL(P);i.searchParams.set("action","markPaid"),i.searchParams.set("row",String(t)),i.searchParams.set("fee",String(o)),i.searchParams.set("key",E);const d=await $fetch(i.toString(),{method:"GET"});if(!(d!=null&&d.success))throw new Error(`æ¨™è¨˜å¤±æ•—ï¼š${JSON.stringify(d).slice(0,200)}`);f(`Row ${t} å·²æ¨™è¨˜åŒ¯æ¬¾`),await A()}catch(i){f((i==null?void 0:i.message)||"æ¨™è¨˜å¤±æ•—")}finally{N.value=null}}return console.log("GAS_BASE_URL",P),console.log("GAS_KEY length",E.length),X(async()=>{await B(),await A()}),(t,e)=>{const o=l("v-btn"),i=l("v-alert"),d=l("v-skeleton-loader"),G=l("v-chip"),L=l("v-divider"),D=l("v-textarea"),F=l("v-text-field"),I=l("v-card-text"),M=l("v-card"),j=l("v-snackbar"),q=l("v-container"),H=l("v-main"),Y=l("v-app");return v(),y(Y,null,{default:s(()=>[a(H,null,{default:s(()=>[a(q,{class:"py-4",style:{"max-width":"720px"}},{default:s(()=>[n("div",se,[n("div",null,[e[1]||(e[1]=n("div",{class:"text-h6 font-weight-bold"},"å‡ºç´åŒ¯æ¬¾æ¸…å–®",-1)),n("div",ae," å¾…åŒ¯æ¬¾ï¼š"+u(c(m).length)+" ç­† ",1)]),a(o,{variant:"tonal","prepend-icon":"mdi-refresh",loading:c(g),onClick:A},{default:s(()=>e[2]||(e[2]=[p(" é‡æ–°æ•´ç† ")])),_:1},8,["loading"])]),c(x)?(v(),y(i,{key:0,type:"error",variant:"tonal",class:"mb-3"},{default:s(()=>[p(u(c(x)),1)]),_:1})):$("",!0),c(g)&&!c(k)?(v(),y(d,{key:1,type:"card, card, card",class:"mb-4"})):c(k)&&!c(m).length?(v(),y(i,{key:2,type:"success",variant:"tonal"},{default:s(()=>e[3]||(e[3]=[p(" ç›®å‰æ²’æœ‰å¾…åŒ¯æ¬¾é …ç›® ğŸ‰ ")])),_:1})):$("",!0),(v(!0),Z(W,null,Q(c(m),r=>(v(),y(M,{key:r.row,class:"mb-3",rounded:"md",elevation:"3"},{default:s(()=>[a(I,{class:"pa-4"},{default:s(()=>[n("div",re,[a(G,{color:"primary",class:"amount-chip"},{default:s(()=>[p(" NT$ "+u(r.amount),1)]),_:2},1024),n("div",le," Row "+u(r.row),1)]),n("div",ce,[e[4]||(e[4]=n("div",{class:"text-caption text-medium-emphasis"},"ä»˜æ¬¾å°è±¡",-1)),n("div",ie,u(r.payee||"ï¼ˆä»˜æ¬¾å°è±¡ç©ºï¼‰"),1)]),n("div",de,[e[5]||(e[5]=n("div",{class:"text-caption text-medium-emphasis"},"ç”³è«‹äºº",-1)),n("div",ue,u(r.applicant||"ï¼ˆä»˜æ¬¾å°è±¡ç©ºï¼‰"),1)]),n("div",me,[e[6]||(e[6]=n("div",{class:"text-caption text-medium-emphasis"},"é ç®—ç·¨è™Ÿ",-1)),n("div",pe,u(r.budgetCode||"ï¼ˆç©ºï¼‰"),1),a(G,{size:"small",variant:"tonal",class:"text-subtitle-2 font-weight-bold",color:C(r.budgetCode)==="å¯Œé‚¦"?"blue":"red"},{default:s(()=>[p(u(C(r.budgetCode)),1)]),_:2},1032,["color"])]),n("div",_e,[e[7]||(e[7]=n("div",{class:"text-caption text-medium-emphasis"},"ç”¨é€”",-1)),n("div",fe,u(r.purpose||"ï¼ˆä»˜æ¬¾å°è±¡ç©ºï¼‰"),1)]),a(L,{class:"my-3"}),n("div",ve,[e[8]||(e[8]=n("div",{class:"text-caption text-medium-emphasis mb-1"},"ä»˜æ¬¾è³‡è¨Š",-1)),a(D,{"model-value":r.payInfo,readonly:"","auto-grow":"",rows:"1",variant:"outlined",density:"compact","hide-details":""},null,8,["model-value"])]),n("div",ge,[a(o,{variant:"tonal","prepend-icon":"mdi-content-copy",class:"btn-copy",onClick:V=>J(r.payInfo)},{default:s(()=>e[9]||(e[9]=[p(" è¤‡è£½ä»˜æ¬¾å¸³è™Ÿ ")])),_:2},1032,["onClick"]),a(F,{modelValue:c(_)[r.row],"onUpdate:modelValue":V=>c(_)[r.row]=V,type:"number",inputmode:"numeric",label:"æ‰‹çºŒè²»",variant:"outlined",density:"compact",class:"fee-input","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),a(L,{class:"my-4"}),n("div",xe,[a(o,{color:"primary",variant:"flat",size:"large",class:"btn-paid",loading:c(N)===r.row,disabled:c(N)!==null,"prepend-icon":"mdi-check",onClick:V=>T(r.row)},{default:s(()=>e[10]||(e[10]=[p(" å·²åŒ¯æ¬¾ ")])),_:2},1032,["loading","disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128)),a(j,{modelValue:c(S).show,"onUpdate:modelValue":e[0]||(e[0]=r=>c(S).show=r),timeout:1600},{default:s(()=>[p(u(c(S).text),1)]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}}),we=ee(ye,[["__scopeId","data-v-66aaea19"]]),be={class:"d-flex align-center justify-center"},Ne={__name:"cashier",setup(K){return oe({title:"åŒ¯æ¬¾æ¸…å–® | å¤¢æƒ³ä¹‹éƒ½å·¥ä½œå®¤"}),(w,b)=>{const B=we,C=ne,m=l("v-progress-circular"),g=l("v-container"),x=te,k=l("v-main"),_=l("v-app");return v(),y(_,null,{default:s(()=>[a(k,null,{default:s(()=>[a(x,null,{fallback:s(()=>[a(g,{class:"py-10",style:{"max-width":"520px"}},{default:s(()=>[n("div",be,[a(m,{indeterminate:""}),b[0]||(b[0]=n("div",{class:"text-body-2 text-medium-emphasis ms-3"},"è¼‰å…¥ä¸­â€¦",-1))])]),_:1})]),default:s(()=>[a(C,{pin:"0919","storage-key":"cashier_pin_ok"},{default:s(()=>[a(B)]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Ne as default};
