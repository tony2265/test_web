import{u as Ve}from"./DEdOYbya.js";import{r as M,d as Me,K as oe,j as V,o as Ue,F as ne,i as c,t as d,L as C,A as l,z as r,x as v,y as h,M as t,B as S,N as I,v as P,O as T,P as Y,_ as Ne}from"./N59N5Gxu.js";function Re(k="hidden_iframe"){let m=document.getElementById(k);return m||(m=document.createElement("iframe"),m.name=k,m.id=k,m.style.display="none",document.body.appendChild(m)),m}function Le(k,m){const b=document.createElement("form");return b.action=k,b.method="POST",b.target=m,b.style.display="none",b}function q(k,m,b){const x=document.createElement("input");x.type="hidden",x.name=m,x.value=b??"",k.appendChild(x)}function Ie(){const k=M(!1),m=M(!1),b=M(null);async function x(w,_){var o;k.value=!0,m.value=!1,b.value=null;try{const i=Re("hidden_iframe"),f=Le(_.formPostUrl,"hidden_iframe");q(f,"usp","pp_url");for(const g of _.steps){if(!g.entry)continue;const y=(w[g.key]??"").trim();y&&q(f,g.entry,y)}const a=((o=_.getExtraFields)==null?void 0:o.call(_))??[];for(const g of a){const y=(g.value??"").trim();y&&q(f,g.name,y)}await new Promise(g=>{const y=()=>{i.removeEventListener("load",y),g()};i.addEventListener("load",y),document.body.appendChild(f),f.submit(),f.remove()}),m.value=!0}catch(i){b.value=(i==null?void 0:i.message)??String(i)}finally{k.value=!1}}function j(w,_,o,i){const f=new URLSearchParams;f.set("usp","pp_url");for(const g of o){if(!g.entry)continue;const y=(_[g.key]??"").trim();y&&f.set(g.entry,y)}const a=(i==null?void 0:i())??[];for(const g of a){const y=(g.value??"").trim();y&&f.set(g.name,y)}return`${w}?${f.toString()}`}return{submitting:k,submitOk:m,submitError:b,submitDirect:x,buildPrefilledUrl:j}}const Te={class:"d-flex align-center justify-space-between mb-4"},je={class:"text-caption text-medium-emphasis ml-1"},Be={class:"text-subtitle-1 font-weight-bold mb-2"},De={key:0,class:"text-caption text-medium-emphasis mb-4"},Ee={class:"mt-3 d-flex flex-wrap gap-2"},Ae={key:7,class:"text-body-2 text-error"},Oe={key:8,class:"mt-4"},Fe={key:9,class:"mt-4"},He={class:"text-body-2"},Je={class:"text-medium-emphasis force-blue"},$e={class:"text-body-1 force-black"},Ge={class:"mt-2"},Qe="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/formResponse",ze="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=0&single=true&output=csv",Ye="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=691371121&single=true&output=csv",qe="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/viewform",We=Me({__name:"OMainPage",setup(k){const{submitting:m,submitOk:b,submitError:x,submitDirect:j}=Ie(),w={applicant:"entry.227203665",budgetCode:"entry.798019421",amount:"entry.781561663",purpose:"entry.911688229",payee:"entry.1906095594",payMethod:"entry.93780387",payInfo:"entry.627391982",payProof:"entry.1651297620"},_=M([{key:"applicant",label:"申請人",type:"select",options:["嗡嗡","Nick","CB"],entry:w.applicant},{key:"budgetName",label:"預算名稱",type:"select",source:"budgets",hint:"選名稱後會自動帶入「預算編號」"},{key:"amount",label:"金額",type:"number",entry:w.amount,placeholder:"例如：4000"},{key:"purpose",label:"用途",type:"text",entry:w.purpose,placeholder:""},{key:"payee",label:"付款對象",type:"select",source:"payees",entry:w.payee,hint:"可從清單選擇，或直接輸入自訂名稱（仍可手動修改）"},{key:"payMethod",label:"付款方式",type:"select",options:["匯款","現金","代墊"],entry:w.payMethod},{key:"payInfo",label:"付款資訊",type:"text",entry:w.payInfo,placeholder:"(銀行代碼) 匯款帳號"},{key:"payProof",label:"付款憑證",type:"select",options:["勞報單","電子發票","紙本發票(發票機統一發票、二聯/三聯式發票)","收據、免用統一發票收據","無須付款憑證(米畫師)","無須付款憑證(Steam)","無須付款憑證(NYCU)","無須付款憑證(其他，需於申請時補充於頻道)"],entry:w.payProof}]),o=oe({applicant:"",budgetName:"",budgetCode:"",amount:"",purpose:"",payee:"",payMethod:"",payInfo:"",payProof:""}),i=M(0),f=V(()=>i.value===_.value.length),a=V(()=>_.value[i.value]),g=V(()=>Math.round(i.value/_.value.length*100)),y=M(!1),F=M([]),D=M([]),ae=["嘟比","灯理","煦","妮酷","陳旭元","OP","ED","PV","Teaser","Cover","精華剪輯","混音","美術圖","Q版圖","動態","製作","Google廣告","中之人報酬","季結算","分潤","營業稅"],H=V({get:()=>o.purpose??"",set:n=>o.purpose=n});function le(n){const e=(H.value||"").trim();e.includes(n)||(H.value=e?`${e}${n}`:n)}function se(){H.value=""}function W(n){const e=n.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);if(e.length<2)return[];const u=e[0].split(",").map(s=>s.trim());return e.slice(1).map(s=>{const G=s.split(",").map(B=>B.trim()),R={};return u.forEach((B,L)=>R[B]=G[L]??""),R})}async function re(){y.value=!0;try{const[n,e]=await Promise.all([fetch(ze).then(s=>s.text()),fetch(Ye).then(s=>s.text())]),u=W(n),U=W(e);F.value=u.filter(s=>s.name).map(s=>({name:s.name,code:s.code})),D.value=U.filter(s=>s.name).map(s=>({name:s.name,method:s.method??"",info:s.info??"",proof:s.proof??""}))}finally{y.value=!1}}Ue(()=>{re().catch(console.error)}),ne(()=>o.budgetName,n=>{if(!n){o.budgetCode="";return}const e=F.value.find(u=>u.name===n);e&&(o.budgetCode=e.code||"")}),ne(()=>o.payee,n=>{if(!n){o.payMethod="",o.payInfo="",o.payProof="";return}const e=D.value.find(u=>u.name===n);if(!e){o.payMethod="",o.payInfo="",o.payProof="";return}o.payMethod=e.method||"",o.payInfo=e.info||"",o.payProof=e.proof||""});const ie=V(()=>o.payee?D.value.some(n=>n.name===o.payee):!1);function X(n){return n.options?n.options:n.source==="budgets"?F.value.map(e=>e.name):n.source==="payees"?D.value.map(e=>e.name):[]}function de(){i.value<_.value.length&&(i.value+=1)}function ue(){i.value>0&&(i.value-=1)}const pe=V(()=>[{cols:[{label:"申請人",value:o.applicant}]},{cols:[{label:"預算編號",value:o.budgetName}]},{cols:[{label:"金額",value:o.amount}]},{cols:[{label:"用途",value:o.purpose}]},{cols:[{label:"付款對象",value:o.payee}]},{cols:[{label:"付款方式",value:o.payMethod},{label:"付款資訊",value:o.payInfo}]},{cols:[{label:"付款憑證",value:o.payProof}]}]),J=M(!1),ce=V(()=>["applicant","budgetName","budgetCode","amount","purpose","payee","payMethod","payProof"]),K=V(()=>{const n={applicant:"申請人",budgetName:"預算名稱",budgetCode:"預算編號",amount:"金額",purpose:"用途",payee:"付款對象",payMethod:"付款方式",payProof:"付款憑證"},e=[];for(const u of ce.value)(o[u]??"").trim()||e.push(n[u]??u);return e}),Z=V(()=>K.value.length===0);async function me(){if(J.value=!0,!Z.value){$("欄位未填完整，無法送出（付款資訊可留白）","error");return}await ge(),b.value?($("已成功送出，表單已清空","success"),fe()):$(x.value?`送出失敗：${x.value}`:"送出失敗","error")}const N=oe({show:!1,text:"",color:"success"});function $(n,e="success"){N.text=n,N.color=e,N.show=!0}function fe(){for(const n of Object.keys(o))o[n]="";i.value=0,J.value=!1,typeof b<"u"&&(b.value=!1),typeof x<"u"&&(x.value=null)}function ye(){const n=new URLSearchParams;n.set("usp","pp_url");const e=(o.budgetCode??"").trim();e&&n.set(w.budgetCode,e);for(const u of _.value){if(!u.entry||u.key==="budgetCode")continue;const U=(o[u.key]??"").trim();U&&n.set(u.entry,U)}return`${qe}?${n.toString()}`}function ve(){const n=ye();window.open(n,"_blank")}function ge(){return j(o,{formPostUrl:Qe,entryMap:w,steps:_.value,getExtraFields:()=>{const n=[],e=(o.budgetCode??"").trim();return e&&n.push({name:w.budgetCode,value:e}),n}})}return(n,e)=>{const u=c("v-chip"),U=c("v-progress-linear"),s=c("v-combobox"),G=c("v-select"),R=c("v-text-field"),B=c("v-textarea"),L=c("v-alert"),E=c("v-col"),Q=c("v-row"),be=c("v-list-item"),_e=c("v-list"),he=c("v-card"),we=c("v-snackbar"),z=c("v-btn"),ke=c("v-footer"),xe=c("v-container"),Se=c("v-main"),Ce=c("v-app");return d(),C(Ce,null,{default:l(()=>[r(Se,null,{default:l(()=>[r(Q,{class:"fill-height",align:"center",justify:"center","no-gutters":""},{default:l(()=>[r(E,{cols:"12",sm:"10",md:"8",lg:"6"},{default:l(()=>[r(xe,{class:"py-6"},{default:l(()=>[v("div",Te,[v("div",null,[e[8]||(e[8]=v("div",{class:"text-h6 font-weight-bold"},"出帳表單 / DreamCity",-1)),v("div",je,h(t(i)+1)+" / "+h(t(_).length+1),1)]),t(f)?(d(),C(u,{key:0,color:"primary",variant:"flat"},{default:l(()=>e[9]||(e[9]=[S(" 已完成 ")])),_:1})):I("",!0)]),r(U,{"model-value":t(g),height:"8",rounded:"",color:"primary","bg-color":"primary-lighten-4",class:"mb-4"},null,8,["model-value"]),r(he,{rounded:"md",class:"pa-0 elevation-0"},{default:l(()=>[t(f)?(d(),P(T,{key:1},[r(_e,{density:"compact",class:"elevation-2 ma-1"},{default:l(()=>[(d(!0),P(T,null,Y(t(pe),(p,ee)=>(d(),C(be,{key:ee},{default:l(()=>[r(Q,{dense:""},{default:l(()=>[(d(!0),P(T,null,Y(p.cols,(te,Pe)=>(d(),C(E,{key:Pe,cols:"12"},{default:l(()=>[v("div",He,[v("span",Je,h(te.label),1)]),v("div",$e,h(te.value||"（空）"),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),r(L,{class:"mt-4",variant:"tonal",type:"warning",density:"compact"},{default:l(()=>e[19]||(e[19]=[S(" 確認內容無誤，生成後，請在 Google 表單按下「送出」方可完成申請。 ")])),_:1}),t(f)&&t(J)&&!t(Z)?(d(),C(L,{key:0,class:"mt-4",variant:"tonal",type:"error",density:"compact"},{default:l(()=>[e[20]||(e[20]=S(" 無法送出：以下欄位不得為空（付款資訊可留白）： ")),v("div",Ge,[v("b",null,h(t(K).join("、")),1)])]),_:1})):I("",!0)],64)):(d(),P(T,{key:0},[v("div",Be,h(t(a).label),1),t(a).hint?(d(),P("div",De,h(t(a).hint),1)):I("",!0),t(a).key==="payee"?(d(),C(s,{key:1,modelValue:t(o).payee,"onUpdate:modelValue":e[0]||(e[0]=p=>t(o).payee=p),items:X(t(a)),placeholder:"選擇或自行輸入付款對象",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","items"])):t(a).type==="select"?(d(),C(G,{key:2,items:X(t(a)),modelValue:t(o)[t(a).key],"onUpdate:modelValue":e[1]||(e[1]=p=>t(o)[t(a).key]=p),placeholder:t(a).placeholder||"請選擇",disabled:t(a).disabled,loading:t(a).source?t(y):!1,variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["items","modelValue","placeholder","disabled","loading"])):t(a).key==="purpose"?(d(),P(T,{key:3},[r(R,{modelValue:t(o).purpose,"onUpdate:modelValue":e[2]||(e[2]=p=>t(o).purpose=p),placeholder:t(a).placeholder||"例如：灯理PV製作",readonly:t(a).readonly,disabled:t(a).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",clearable:""},null,8,["modelValue","placeholder","readonly","disabled"]),v("div",Ee,[(d(),P(T,null,Y(ae,p=>r(u,{key:p,size:"small",variant:"outlined",class:"cursor-pointer",onClick:ee=>le(String(p))},{default:l(()=>[S(h(p),1)]),_:2},1032,["onClick"])),64)),r(u,{size:"small",variant:"tonal",color:"error",class:"cursor-pointer",onClick:se},{default:l(()=>e[10]||(e[10]=[S(" 清空 ")])),_:1})])],64)):t(a).type==="text"?(d(),C(R,{key:4,modelValue:t(o)[t(a).key],"onUpdate:modelValue":e[3]||(e[3]=p=>t(o)[t(a).key]=p),placeholder:t(a).placeholder||"請輸入",readonly:t(a).readonly,disabled:t(a).disabled,variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","placeholder","readonly","disabled"])):t(a).type==="number"?(d(),C(R,{key:5,modelValue:t(o)[t(a).key],"onUpdate:modelValue":e[4]||(e[4]=p=>t(o)[t(a).key]=p),type:"number",inputmode:"numeric",placeholder:t(a).placeholder||"請輸入數字",variant:"outlined",density:"comfortable","hide-details":"auto"},null,8,["modelValue","placeholder"])):t(a).type==="textarea"?(d(),C(B,{key:6,modelValue:t(o)[t(a).key],"onUpdate:modelValue":e[5]||(e[5]=p=>t(o)[t(a).key]=p),placeholder:t(a).placeholder||"請輸入",variant:"outlined",density:"comfortable",rows:"3","auto-grow":"","hide-details":"auto"},null,8,["modelValue","placeholder"])):(d(),P("div",Ae," 未支援的輸入類型："+h(t(a).type),1)),t(a).key==="budgetName"&&t(o).budgetCode?(d(),P("div",Oe,[r(L,{variant:"tonal",type:"info",density:"compact"},{default:l(()=>[e[11]||(e[11]=S(" 已自動帶入「預算編號」：")),v("b",null,h(t(o).budgetCode),1)]),_:1})])):I("",!0),t(a).key==="payee"&&t(ie)?(d(),P("div",Fe,[r(L,{variant:"tonal",type:"info",density:"compact"},{default:l(()=>[e[12]||(e[12]=S(" 已自動帶入：")),e[13]||(e[13]=v("br",null,null,-1)),e[14]||(e[14]=S(" 付款方式：")),v("b",null,h(t(o).payMethod||"（空）"),1),e[15]||(e[15]=v("br",null,null,-1)),e[16]||(e[16]=S(" 付款資訊：")),v("b",null,h(t(o).payInfo||"（空）"),1),e[17]||(e[17]=v("br",null,null,-1)),e[18]||(e[18]=S(" 付款憑證：")),v("b",null,h(t(o).payProof||"（空）"),1)]),_:1})])):I("",!0)],64))]),_:1}),r(we,{modelValue:t(N).show,"onUpdate:modelValue":e[6]||(e[6]=p=>t(N).show=p),color:t(N).color,timeout:"2500",location:"bottom"},{default:l(()=>[S(h(t(N).text),1)]),_:1},8,["modelValue","color"]),r(ke,{app:"",elevation:"6",class:"pa-0"},{default:l(()=>[r(Q,{"no-gutters":"",class:"w-100"},{default:l(()=>[r(E,{cols:"3"},{default:l(()=>[r(z,{block:"",height:n.$vuetify.display.smAndDown?72:56,variant:"tonal",class:"rounded-0",disabled:t(i)===0,icon:"mdi-chevron-left",onClick:ue},null,8,["height","disabled"])]),_:1}),r(E,{cols:"9",class:"d-flex align-stretch"},{default:l(()=>[r(z,{class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:n.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat","append-icon":t(f)?"mdi-open-in-new":"mdi-chevron-right",onClick:e[7]||(e[7]=p=>t(f)?ve():de())},{default:l(()=>[S(h(t(f)?"生成並開啟表單":"下一步"),1)]),_:1},8,["height","append-icon"]),t(f)?(d(),C(z,{key:0,class:"rounded-0",height:n.$vuetify.display.smAndDown?72:56,width:"72",variant:"tonal",color:"primary",loading:t(m),disabled:t(m),icon:"mdi-send",onClick:me},null,8,["height","loading","disabled"])):I("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),Xe=Ne(We,[["__scopeId","data-v-44623dc2"]]),A="出帳表單 | 夢想之都工作室",O="僅供內部使用",et={__name:"out",setup(k){return Ve({title:A,meta:[{name:"description",content:O},{property:"og:title",content:A},{itemprop:"name",content:A},{property:"twitter:meta_title",content:A},{property:"og:description",content:O},{itemprop:"description",content:O},{property:"twitter:description",content:O},{property:"og:locale",content:"zh_TW"}],link:[{rel:"icon",href:"https://www.dreamcity.studio/images/logo.ico"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Noto+Serif+TC&family=Roboto+Mono&family=DotGothic16&family=IBM+Plex+Sans+JP:wght@400;700&display=swap"}],script:[{hid:"gtm",innerHTML:`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-KNFPB22');`,type:"text/javascript",charset:"utf-8"},{async:!0,src:"https://www.googletagmanager.com/gtag/js?id=G-10J4H088NL"},{hid:"gtag",innerHTML:`window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-10J4H088NL');`,type:"text/javascript",charset:"utf-8"}],__dangerouslyDisableSanitizersByTagID:{gtm:["innerHTML"],gtag:["innerHTML"]}}),(m,b)=>{const x=c("v-main"),j=c("v-app");return d(),C(j,null,{default:l(()=>[r(x,null,{default:l(()=>[r(Xe)]),_:1})]),_:1})}}};export{et as default};
