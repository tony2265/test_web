import{u as Re}from"./B-jbvm3i.js";import{r as N,d as Le,K as W,j as M,o as Ie,F as re,i as m,t as p,L as S,A as i,z as c,x as g,y as x,M as e,B as P,N as B,v as V,O as T,P as X,_ as Te}from"./Bh3o__X5.js";function $e(_="hidden_iframe"){let f=document.getElementById(_);return f||(f=document.createElement("iframe"),f.name=_,f.id=_,f.style.display="none",document.body.appendChild(f)),f}function je(_,f){const v=document.createElement("form");return v.action=_,v.method="POST",v.target=f,v.style.display="none",v}function K(_,f,v){const w=document.createElement("input");w.type="hidden",w.name=f,w.value=v??"",_.appendChild(w)}function Ee(){const _=N(!1),f=N(!1),v=N(null);async function w(k,b){var n;_.value=!0,f.value=!1,v.value=null;try{const a=$e("hidden_iframe"),h=je(b.formPostUrl,"hidden_iframe");K(h,"usp","pp_url");for(const y of b.steps){if(!y.entry)continue;const s=(k[y.key]??"").trim();s&&K(h,y.entry,s)}const C=((n=b.getExtraFields)==null?void 0:n.call(b))??[];for(const y of C){const s=(y.value??"").trim();s&&K(h,y.name,s)}await new Promise(y=>{const s=()=>{a.removeEventListener("load",s),y()};a.addEventListener("load",s),document.body.appendChild(h),h.submit(),h.remove()}),f.value=!0}catch(a){v.value=(a==null?void 0:a.message)??String(a)}finally{_.value=!1}}function $(k,b,n,a){const h=new URLSearchParams;h.set("usp","pp_url");for(const y of n){if(!y.entry)continue;const s=(b[y.key]??"").trim();s&&h.set(y.entry,s)}const C=(a==null?void 0:a())??[];for(const y of C){const s=(y.value??"").trim();s&&h.set(y.name,s)}return`${k}?${h.toString()}`}return{submitting:_,submitOk:f,submitError:v,submitDirect:w,buildPrefilledUrl:$}}const Be={class:"d-flex align-center justify-space-between mb-4"},De={class:"text-caption text-medium-emphasis ml-1"},Ae={class:"text-subtitle-1 font-weight-bold mb-2"},Fe={key:0,class:"text-caption text-medium-emphasis mb-4"},qe={class:"mt-3 d-flex flex-wrap gap-2"},Oe={key:7,class:"text-body-2 text-error"},He={key:8,class:"mt-4"},Je={key:9,class:"mt-4"},Ge={class:"text-body-2"},Qe={class:"text-medium-emphasis force-blue"},ze={class:"text-body-1 force-black"},Ye="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/formResponse",We="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=0&single=true&output=csv",Xe="https://docs.google.com/spreadsheets/d/e/2PACX-1vSPtAuRUBtpdVohSDJUwngzRjUPMSqsgOR7RsQv0rI0oanUlC-r7tCNIpJjk6J4b2oalBfuvzoh50PS/pub?gid=691371121&single=true&output=csv",Ke="https://docs.google.com/forms/d/e/1FAIpQLSdoS2XM0vSaExwlJYa_Yo5RtWUoGJqPt3HO7T4fWkQjNSYfAQ/viewform",Ze=Le({__name:"OMainPage",setup(_){const{submitting:f,submitOk:v,submitError:w,submitDirect:$}=Ee(),k={applicant:"entry.227203665",budgetCode:"entry.798019421",amount:"entry.781561663",purpose:"entry.911688229",payee:"entry.1906095594",payMethod:"entry.93780387",payInfo:"entry.627391982",payProof:"entry.1651297620"},b=N([{key:"applicant",label:"申請人",type:"select",options:["嗡嗡","Nick","CB","Rice"],entry:k.applicant,required:!0},{key:"budgetName",label:"預算名稱",type:"select",source:"budgets",hint:"選名稱後會自動帶入「預算編號」",required:!0},{key:"amount",label:"金額",type:"number",entry:k.amount,placeholder:"例如：4000",required:!0},{key:"purpose",label:"用途",type:"text",entry:k.purpose,placeholder:"",required:!0},{key:"payee",label:"付款對象",type:"select",source:"payees",entry:k.payee,hint:"可從清單選擇，或直接輸入自訂名稱（仍可手動修改）",required:!0},{key:"payMethod",label:"付款方式",type:"select",options:["匯款","現金","代墊"],entry:k.payMethod,required:!0},{key:"payInfo",label:"付款資訊",type:"text",entry:k.payInfo,placeholder:"(銀行代碼) 匯款帳號",required:!1},{key:"payProof",label:"付款憑證",type:"select",options:["勞報單","電子發票","紙本發票(發票機統一發票、二聯/三聯式發票)","收據、免用統一發票收據","無須付款憑證(米畫師)","無須付款憑證(Steam)","無須付款憑證(NYCU)","無須付款憑證(其他，需於申請時補充於頻道)"],entry:k.payProof,required:!0}]),n=W({applicant:"",budgetName:"",budgetCode:"",amount:"",purpose:"",payee:"",payMethod:"",payInfo:"",payProof:""}),a=W({});function h(o,t){a[o]=t}function C(o){a[o]=""}function y(){const o=r.value;if(!o)return!0;if(!o.required)return C(o.key),!0;const t=(n[o.key]??"").trim();if(!t)return h(o.key,`「${o.label}」為必填，請先填寫`),L(`請先填寫：${o.label}`,"error"),!1;if(o.key==="budgetName"&&!(n.budgetCode??"").trim())return h(o.key,"此預算名稱尚未帶入預算編號，請確認清單資料或重新選擇"),L("預算名稱尚未帶入預算編號","error"),!1;if(o.key==="amount"){const u=Number(t);if(!Number.isFinite(u)||u<0)return h(o.key,"金額需為正整數"),L("金額格式不正確","error"),!1}return C(o.key),!0}const s=N(0),D=M(()=>s.value===b.value.length),r=M(()=>b.value[s.value]),ae=M(()=>Math.round(s.value/b.value.length*100)),J=N(!1),G=N([]),A=N([]),le=["嘟比","灯理","煦","妮酷","陳旭元","OP","ED","PV","Teaser","Cover","精華剪輯","混音","美術圖","Q版圖","動態","製作","Google廣告","中之人報酬","季結算","分潤","營業稅"],Q=M({get:()=>n.purpose??"",set:o=>n.purpose=o});function se(o){const t=(Q.value||"").trim();t.includes(o)||(Q.value=t?`${t}${o}`:o)}function ie(){Q.value=""}function Z(o){const t=o.split(/\r?\n/).map(d=>d.trim()).filter(Boolean);if(t.length<2)return[];const u=t[0].split(",").map(d=>d.trim());return t.slice(1).map(d=>{const z=d.split(",").map(j=>j.trim()),I={};return u.forEach((j,E)=>I[j]=z[E]??""),I})}async function ue(){J.value=!0;try{const[o,t]=await Promise.all([fetch(We).then(d=>d.text()),fetch(Xe).then(d=>d.text())]),u=Z(o),U=Z(t);G.value=u.filter(d=>d.name).map(d=>({name:d.name,code:d.code})),A.value=U.filter(d=>d.name).map(d=>({name:d.name,method:d.method??"",info:d.info??"",proof:d.proof??""}))}finally{J.value=!1}}Ie(()=>{ue().catch(console.error)}),re(()=>n.budgetName,o=>{if(!o){n.budgetCode="";return}const t=G.value.find(u=>u.name===o);t&&(n.budgetCode=t.code||"")}),re(()=>n.payee,o=>{if(!o){n.payMethod="",n.payInfo="",n.payProof="";return}const t=A.value.find(u=>u.name===o);if(!t){n.payMethod="",n.payInfo="",n.payProof="";return}n.payMethod=t.method||"",n.payInfo=t.info||"",n.payProof=t.proof||""});const de=M(()=>n.payee?A.value.some(o=>o.name===n.payee):!1);function ee(o){return o.options?o.options:o.source==="budgets"?G.value.map(t=>t.name):o.source==="payees"?A.value.map(t=>t.name):[]}function pe(){y()&&s.value<b.value.length&&(s.value+=1)}function ce(){s.value>0&&(s.value-=1)}const me=M(()=>[{cols:[{label:"申請人",value:n.applicant}]},{cols:[{label:"預算編號",value:n.budgetName}]},{cols:[{label:"金額",value:n.amount}]},{cols:[{label:"用途",value:n.purpose}]},{cols:[{label:"付款對象",value:n.payee}]},{cols:[{label:"付款方式",value:n.payMethod},{label:"付款資訊",value:n.payInfo}]},{cols:[{label:"付款憑證",value:n.payProof}]}]),te=N(!1),fe=M(()=>["applicant","budgetName","budgetCode","amount","purpose","payee","payMethod","payProof"]),ye=M(()=>{const o={applicant:"申請人",budgetName:"預算名稱",budgetCode:"預算編號",amount:"金額",purpose:"用途",payee:"付款對象",payMethod:"付款方式",payProof:"付款憑證"},t=[];for(const u of fe.value)(n[u]??"").trim()||t.push(o[u]??u);return t}),ve=M(()=>ye.value.length===0);async function ge(){if(te.value=!0,!ve.value){L("欄位未填完整，無法送出（付款資訊可留白）","error");return}await _e(),v.value?(L("已成功送出，表單已清空","success"),be()):L(w.value?`送出失敗：${w.value}`:"送出失敗","error")}const R=W({show:!1,text:"",color:"success"});function L(o,t="success"){R.text=o,R.color=t,R.show=!0}function be(){for(const o of Object.keys(n))n[o]="";s.value=0,te.value=!1,typeof v<"u"&&(v.value=!1),typeof w<"u"&&(w.value=null)}function he(){const o=new URLSearchParams;o.set("usp","pp_url");const t=(n.budgetCode??"").trim();t&&o.set(k.budgetCode,t);for(const u of b.value){if(!u.entry||u.key==="budgetCode")continue;const U=(n[u.key]??"").trim();U&&o.set(u.entry,U)}return`${Ke}?${o.toString()}`}function ke(){const o=he();window.open(o,"_blank")}function _e(){return $(n,{formPostUrl:Ye,entryMap:k,steps:b.value,getExtraFields:()=>{const o=[],t=(n.budgetCode??"").trim();return t&&o.push({name:k.budgetCode,value:t}),o}})}return(o,t)=>{const u=m("v-chip"),U=m("v-progress-linear"),d=m("v-combobox"),z=m("v-select"),I=m("v-text-field"),j=m("v-textarea"),E=m("v-alert"),F=m("v-col"),Y=m("v-row"),we=m("v-list-item"),xe=m("v-list"),Se=m("v-card"),Ce=m("v-snackbar"),q=m("v-btn"),Pe=m("v-footer"),Ve=m("v-container"),Me=m("v-main"),Ne=m("v-app");return p(),S(Ne,null,{default:i(()=>[c(Me,null,{default:i(()=>[c(Y,{class:"fill-height",align:"center",justify:"center","no-gutters":""},{default:i(()=>[c(F,{cols:"12",sm:"10",md:"8",lg:"6"},{default:i(()=>[c(Ve,{class:"py-6"},{default:i(()=>[g("div",Be,[g("div",null,[t[14]||(t[14]=g("div",{class:"text-h6 font-weight-bold"},"出帳表單 / DreamCity",-1)),g("div",De,x(e(s)+1)+" / "+x(e(b).length+1),1)]),e(D)?(p(),S(u,{key:0,color:"primary",variant:"flat"},{default:i(()=>t[15]||(t[15]=[P(" 已完成 ")])),_:1})):B("",!0)]),c(U,{"model-value":e(ae),height:"8",rounded:"",color:"primary","bg-color":"primary-lighten-4",class:"mb-4"},null,8,["model-value"]),c(Se,{rounded:"md",class:"pa-0 elevation-0"},{default:i(()=>[e(D)?(p(),V(T,{key:1},[c(xe,{density:"compact",class:"elevation-2 ma-1"},{default:i(()=>[(p(!0),V(T,null,X(e(me),(l,oe)=>(p(),S(we,{key:oe},{default:i(()=>[c(Y,{dense:""},{default:i(()=>[(p(!0),V(T,null,X(l.cols,(ne,Ue)=>(p(),S(F,{key:Ue,cols:"12"},{default:i(()=>[g("div",Ge,[g("span",Qe,x(ne.label),1)]),g("div",ze,x(ne.value||"（空）"),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),c(E,{class:"mt-4",variant:"tonal",type:"warning",density:"compact"},{default:i(()=>t[25]||(t[25]=[P(" 確認內容無誤，生成後，請在 Google 表單按下「送出」方可完成申請。 ")])),_:1})],64)):(p(),V(T,{key:0},[g("div",Ae,x(e(r).label),1),e(r).hint?(p(),V("div",Fe,x(e(r).hint),1)):B("",!0),e(r).key==="payee"?(p(),S(d,{key:1,modelValue:e(n).payee,"onUpdate:modelValue":[t[0]||(t[0]=l=>e(n).payee=l),t[1]||(t[1]=l=>C(e(r).key))],items:ee(e(r)),placeholder:"選擇或自行輸入付款對象",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["modelValue","items","error","error-messages"])):e(r).type==="select"?(p(),S(z,{key:2,items:ee(e(r)),modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[2]||(t[2]=l=>e(n)[e(r).key]=l),t[3]||(t[3]=l=>C(e(r).key))],placeholder:e(r).placeholder||"請選擇",disabled:e(r).disabled,loading:e(r).source?e(J):!1,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["items","modelValue","placeholder","disabled","loading","error","error-messages"])):e(r).key==="purpose"?(p(),V(T,{key:3},[c(I,{modelValue:e(n).purpose,"onUpdate:modelValue":[t[4]||(t[4]=l=>e(n).purpose=l),t[5]||(t[5]=l=>C(e(r).key))],placeholder:e(r).placeholder||"例如：灯理PV製作",readonly:e(r).readonly,disabled:e(r).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",clearable:"",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["modelValue","placeholder","readonly","disabled","error","error-messages"]),g("div",qe,[(p(),V(T,null,X(le,l=>c(u,{key:l,size:"small",variant:"outlined",class:"cursor-pointer",onClick:oe=>se(String(l))},{default:i(()=>[P(x(l),1)]),_:2},1032,["onClick"])),64)),c(u,{size:"small",variant:"tonal",color:"error",class:"cursor-pointer",onClick:ie},{default:i(()=>t[16]||(t[16]=[P(" 清空 ")])),_:1})])],64)):e(r).type==="text"?(p(),S(I,{key:4,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[6]||(t[6]=l=>e(n)[e(r).key]=l),t[7]||(t[7]=l=>C(e(r).key))],placeholder:e(r).placeholder||"請輸入",readonly:e(r).readonly,disabled:e(r).disabled,variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["modelValue","placeholder","readonly","disabled","error","error-messages"])):e(r).type==="number"?(p(),S(I,{key:5,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[8]||(t[8]=l=>e(n)[e(r).key]=l),t[9]||(t[9]=l=>C(e(r).key))],type:"number",inputmode:"numeric",placeholder:e(r).placeholder||"請輸入數字",variant:"outlined",density:"comfortable","hide-details":"auto",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["modelValue","placeholder","error","error-messages"])):e(r).type==="textarea"?(p(),S(j,{key:6,modelValue:e(n)[e(r).key],"onUpdate:modelValue":[t[10]||(t[10]=l=>e(n)[e(r).key]=l),t[11]||(t[11]=l=>C(e(r).key))],placeholder:e(r).placeholder||"請輸入",variant:"outlined",density:"comfortable",rows:"3","auto-grow":"","hide-details":"auto",error:!!e(a)[e(r).key],"error-messages":e(a)[e(r).key]},null,8,["modelValue","placeholder","error","error-messages"])):(p(),V("div",Oe," 未支援的輸入類型："+x(e(r).type),1)),e(r).key==="budgetName"&&e(n).budgetCode?(p(),V("div",He,[c(E,{variant:"tonal",type:"info",density:"compact"},{default:i(()=>[t[17]||(t[17]=P(" 已自動帶入「預算編號」：")),g("b",null,x(e(n).budgetCode),1)]),_:1})])):B("",!0),e(r).key==="payee"&&e(de)?(p(),V("div",Je,[c(E,{variant:"tonal",type:"info",density:"compact"},{default:i(()=>[t[18]||(t[18]=P(" 已自動帶入：")),t[19]||(t[19]=g("br",null,null,-1)),t[20]||(t[20]=P(" 付款方式：")),g("b",null,x(e(n).payMethod||"（空）"),1),t[21]||(t[21]=g("br",null,null,-1)),t[22]||(t[22]=P(" 付款資訊：")),g("b",null,x(e(n).payInfo||"（空）"),1),t[23]||(t[23]=g("br",null,null,-1)),t[24]||(t[24]=P(" 付款憑證：")),g("b",null,x(e(n).payProof||"（空）"),1)]),_:1})])):B("",!0)],64))]),_:1}),c(Ce,{modelValue:e(R).show,"onUpdate:modelValue":t[12]||(t[12]=l=>e(R).show=l),color:e(R).color,timeout:"2500",location:"bottom"},{default:i(()=>[P(x(e(R).text),1)]),_:1},8,["modelValue","color"]),c(Pe,{app:"",elevation:"6",class:"pa-0"},{default:i(()=>[c(Y,{"no-gutters":"",class:"w-100"},{default:i(()=>[c(F,{cols:"3"},{default:i(()=>[c(q,{block:"",height:o.$vuetify.display.smAndDown?72:56,variant:"tonal",class:"rounded-0",disabled:e(s)===0,icon:"mdi-chevron-left",onClick:ce},null,8,["height","disabled"])]),_:1}),c(F,{cols:"9",class:"d-flex align-stretch"},{default:i(()=>[e(D)?(p(),S(q,{key:1,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:o.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat",loading:e(f),disabled:e(f),"append-icon":"mdi-send",onClick:ge},{default:i(()=>t[27]||(t[27]=[P(" 直接送出 ")])),_:1},8,["height","loading","disabled"])):(p(),S(q,{key:0,class:"flex-grow-1 rounded-0 text-h6 font-weight-medium",height:o.$vuetify.display.smAndDown?72:56,color:"primary",variant:"flat","append-icon":"mdi-chevron-right",onClick:t[13]||(t[13]=l=>pe())},{default:i(()=>t[26]||(t[26]=[P(" 下一步 ")])),_:1},8,["height"])),e(D)?(p(),S(q,{key:2,class:"rounded-0",height:o.$vuetify.display.smAndDown?72:56,width:"72",variant:"tonal",color:"primary",icon:"mdi-open-in-new",onClick:ke},null,8,["height"])):B("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}}),et=Te(Ze,[["__scopeId","data-v-c7ed14e8"]]),O="出帳表單 | 夢想之都工作室",H="僅供內部使用",nt={__name:"out",setup(_){return Re({title:O,meta:[{name:"description",content:H},{property:"og:title",content:O},{itemprop:"name",content:O},{property:"twitter:meta_title",content:O},{property:"og:description",content:H},{itemprop:"description",content:H},{property:"twitter:description",content:H},{property:"og:locale",content:"zh_TW"}],link:[{rel:"icon",href:"https://www.dreamcity.studio/images/logo.ico"},{rel:"stylesheet",href:"https://fonts.googleapis.com/css2?family=Noto+Serif+TC&family=Roboto+Mono&family=DotGothic16&family=IBM+Plex+Sans+JP:wght@400;700&display=swap"}],script:[{hid:"gtm",innerHTML:`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-KNFPB22');`,type:"text/javascript",charset:"utf-8"},{async:!0,src:"https://www.googletagmanager.com/gtag/js?id=G-10J4H088NL"},{hid:"gtag",innerHTML:`window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-10J4H088NL');`,type:"text/javascript",charset:"utf-8"}],__dangerouslyDisableSanitizersByTagID:{gtm:["innerHTML"],gtag:["innerHTML"]}}),(f,v)=>{const w=m("v-main"),$=m("v-app");return p(),S($,null,{default:i(()=>[c(w,null,{default:i(()=>[c(et)]),_:1})]),_:1})}}};export{nt as default};
